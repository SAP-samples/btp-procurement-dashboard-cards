sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox"],function(e,t,r){"use strict";return e.extend("sap.ariba.MyContractWorkspacesAPI.Main",{onInit:function(){this._initViewModel();var e=new t;this.getView().setModel(e,"contracts");e.refresh(true);this._getData()},_initViewModel:function(){var e=new t({busy:false});this.getView().setModel(e,"oViewModel")},_getDatePreviousXDays:function(e){var t=new Date;return new Date(t.setDate(t.getDate()-e)).toISOString().split("T")[0]},_getFilter:function(e){var t="";if(e){var r=this._getDatePreviousXDays(-1),a=this._getDatePreviousXDays(e);t="$filter=LastModified lt "+r+" and LastModified gt "+a}return t},handleRefreshButtonPressed:function(){this._getData()},_getData:function(e){this.getView().getModel("oViewModel").setProperty("/busy",true);var t=this.getOwnerComponent().card,a=t.getCombinedParameters();var s={sRealm:a.realm,sFilter:this._getFilter(a.lastXDays),sUser:a.user,sPasswordAdapter:a.passwordAdapter,iTop:a.searchResult};t.request({url:"{{destinations.wzcd}}/doGetMyRecentContractWorkspaces",dataType:"json",method:"POST",withCredentials:true,parameters:s,headers:{"Content-Type":"application/json"}}).then(function(e){var t=this.getView().getModel("contracts");t.setData(e);t.refresh(true);this.getView().getModel("oViewModel").setProperty("/busy",false)}.bind(this)).catch(function(e){this.getView().getModel("oViewModel").setProperty("/busy",false);r.error("There was an error in retrieving data: "+e)}.bind(this))},formatDate:function(e){return e&&e!=="1970-01-01T00:00:00Z"?e&&e.split("T")[0]:""},onListItemPress:function(e){var t=this.getOwnerComponent().card.getCombinedParameters().realm,r=this.getOwnerComponent().card.getCombinedParameters().datacenter,a=e.getSource().getBindingContext("contracts").getObject().ContractId;var s="https://"+r+".ariba.com/Sourcing/Main/ad/viewDocument?realm="+t+"&ID="+a;sap.m.URLHelper.redirect(s,true)}})});