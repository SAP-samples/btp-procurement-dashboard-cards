<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <script type="text/javascript">
    var _oCardInfo = {
        cardWrapperCSSPath : "/tmp/vscode-unpacked/uicard-dk-1.3.20210319.vsix/extension/resources/style/previewwrapper.css",
        cardMetaPath : "/home/user/projects/NexGenUICards/NexGen-Cards/Production/CreateContractWorkspace/manifest.json",
        cardMeta : JSON.parse(unescape("%7B%0A%09%22_version%22%3A%20%221.17.0%22%2C%0A%09%22sap.app%22%3A%20%7B%0A%09%09%22id%22%3A%20%22sap.ariba.CreateContractWorkspace%22%2C%0A%09%09%22type%22%3A%20%22card%22%2C%0A%09%09%22title%22%3A%20%22Create%20Contract%20Workspace%22%2C%0A%09%09%22subTitle%22%3A%20%22SAP%20Ariba%20%22%2C%0A%09%09%22applicationVersion%22%3A%20%7B%0A%09%09%09%22version%22%3A%20%221.0.1%22%0A%09%09%7D%0A%09%7D%2C%0A%09%22sap.ui%22%3A%20%7B%0A%09%09%22technology%22%3A%20%22UI5%22%2C%0A%20%20%20%20%20%20%20%20%22deviceTypes%22%3A%20%7B%22desktop%22%3A%20true%2C%20%22phone%22%3A%20true%2C%20%22tablet%22%3A%20true%7D%2C%0A%09%09%22icons%22%3A%20%7B%0A%09%09%09%22icon%22%3A%20%22sap-icon%3A//product%22%0A%09%09%7D%0A%09%7D%2C%09%0A%09%22sap.card%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%22extension%22%3A%20%22./extension/CreateContractWorkspaceExtension%22%2C%0A%09%09%22header%22%3A%20%7B%0A%09%09%09%22title%22%3A%20%22Create%20Contract%20Workspace%22%2C%0A%09%09%09%22subTitle%22%3A%20%22Create%20Contract%20Workspace%20in%20Ariba%22%2C%0A%09%09%09%22icon%22%3A%20%7B%20%22src%22%3A%20%22sap-icon%3A//form%22%20%7D%0A%09%09%7D%2C%0A%09%09%22type%22%3A%20%22AdaptiveCard%22%2C%0A%20%20%20%20%20%20%20%20%22designtime%22%3A%20%22dt/configuration%22%2C%0A%20%20%20%20%20%20%20%20%22data%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22extension%22%3A%20%7B%0A%09%09%09%09%22method%22%3A%20%22getData%22%0A%09%09%09%7D%0A%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%22configuration%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%22parameters%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22username%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22value%22%3A%20%22%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22type%22%3A%20%22string%22%2C%0A%09%09%09%09%09%22label%22%3A%20%22Username%22%2C%0A%09%09%09%09%09%22description%22%3A%20%22The%20username%20to%20use%20in%20the%20API%20calls.%20Test%20purpose%20only.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22realm%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22value%22%3A%20%22%3CrealmName%3E%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22type%22%3A%20%22string%22%2C%0A%09%09%09%09%09%22label%22%3A%20%22Realm%22%2C%0A%09%09%09%09%09%22description%22%3A%20%22The%20realm%20to%20use%20in%20the%20API%20calls.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22templateId%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22value%22%3A%20%22CW2219870%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22type%22%3A%20%22string%22%2C%0A%09%09%09%09%09%22label%22%3A%20%22Contract%20Workspace%20Template%22%2C%0A%09%09%09%09%09%22description%22%3A%20%22Contract%20Workspace%20Template%20to%20use%20in%20the%20API%20calls.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22currency%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22value%22%3A%20%22EUR%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22type%22%3A%20%22string%22%2C%0A%09%09%09%09%09%22label%22%3A%20%22Contract%20Workspace%20currency%22%2C%0A%09%09%09%09%09%22description%22%3A%20%22Contract%20Workspace%20currency%20to%20use%20in%20the%20API%20calls.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22datacenter%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22value%22%3A%20%22s1%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22type%22%3A%20%22string%22%2C%0A%09%09%09%09%09%22label%22%3A%20%22Base%20Url%20for%20the%20realm%22%2C%0A%09%09%09%09%09%22description%22%3A%20%22Base%20Url%20for%20the%20realm.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22suppliers%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22value%22%3A%20%22%5B%5D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22type%22%3A%20%22string%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22label%22%3A%20%22Code%20List%20Supplier%20for%20the%20realm%22%2C%0A%09%09%09%09%09%22description%22%3A%20%22Code%20List%20Supplier%20for%20the%20realm.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22commodities%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22value%22%3A%20%22%5B%5D%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22type%22%3A%20%22string%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22label%22%3A%20%22Code%20List%20Commodity%20for%20the%20realm%22%2C%0A%09%09%09%09%09%22description%22%3A%20%22Code%20List%20Commodity%20for%20the%20realm.%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22destinations%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22wzcd%22%3A%20%7B%20%22name%22%3A%20%22Work-Zone-Cards-Data%22%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%22actionHandlers%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22submit%22%3A%20%7B%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22url%22%3A%20%22%7B%7Bdestinations.wzcd%7D%7D/doCreateContractWorkspace%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22method%22%3A%20%22POST%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%20%20%20%20%7D%0A%20%20%20%20%20%20%20%20%7D%2C%0A%09%09%22content%22%3A%20%7B%0A%09%09%09%22%24schema%22%3A%20%22http%3A//adaptivecards.io/schemas/adaptive-card.json%22%2C%0A%09%09%09%22type%22%3A%20%22AdaptiveCard%22%2C%0A%09%09%09%22version%22%3A%20%221.0%22%2C%0A%09%09%09%22body%22%3A%20%5B%0A%09%09%09%09%7B%0A%09%09%09%09%09%22type%22%3A%20%22TextBlock%22%2C%0A%09%09%09%09%09%22text%22%3A%20%22Title%22%2C%0A%09%09%09%09%09%22isSubtle%22%3A%20true%2C%0A%09%09%09%09%09%22size%22%3A%20%22medium%22%0A%09%09%09%09%7D%2C%0A%09%09%09%09%7B%0A%09%09%09%09%09%22type%22%3A%20%22Input.Text%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22placeholder%22%3A%20%22Your%20Contract%20Title%22%2C%0A%09%09%09%09%09%22style%22%3A%20%22text%22%2C%0A%09%09%09%09%09%22id%22%3A%20%22sTitle%22%0A%09%09%09%09%7D%2C%0A%09%09%09%09%7B%0A%09%09%09%09%09%22type%22%3A%20%22TextBlock%22%2C%0A%09%09%09%09%09%22text%22%3A%20%22Amount%22%2C%0A%09%09%09%09%09%22isSubtle%22%3A%20true%2C%0A%09%09%09%09%09%22size%22%3A%20%22medium%22%0A%09%09%09%09%7D%2C%0A%09%09%09%09%7B%0A%09%09%09%09%09%22type%22%3A%20%22Input.Text%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22placeholder%22%3A%20%22Your%20Contract%20Amount%22%2C%0A%09%09%09%09%09%22style%22%3A%20%22NumVal%22%2C%0A%09%09%09%09%09%22id%22%3A%20%22sAmount%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%0A%09%09%09%09%7B%0A%09%09%09%09%09%22type%22%3A%20%22TextBlock%22%2C%0A%09%09%09%09%09%22text%22%3A%20%22Supplier%22%2C%0A%09%09%09%09%09%22isSubtle%22%3A%20true%2C%0A%09%09%09%09%09%22size%22%3A%20%22medium%22%0A%09%09%09%09%7D%2C%0A%09%09%09%09%7B%0A%09%09%09%09%09%22type%22%3A%20%22Input.ChoiceSet%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22style%22%3A%20%22compact%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22isMultiSelect%22%3A%20false%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22id%22%3A%20%22sSupplierId%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22choices%22%3A%20%5B%0A%09%09%09%09%09%20%20%7B%0A%09%09%09%09%09%09%22%24data%22%3A%20%22%7Bsuppliers%7D%22%2C%0A%09%09%09%09%09%09%22title%22%3A%20%22%7BSupplierName%7D%22%2C%0A%09%09%09%09%09%09%22value%22%3A%20%22%7BSupplierId%7D%22%0A%09%09%09%09%09%20%20%7D%0A%09%09%09%09%09%5D%0A%09%09%09%09%7D%2C%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%0A%09%09%09%09%7B%0A%09%09%09%09%09%22type%22%3A%20%22TextBlock%22%2C%0A%09%09%09%09%09%22text%22%3A%20%22Commodity%22%2C%0A%09%09%09%09%09%22isSubtle%22%3A%20true%2C%0A%09%09%09%09%09%22size%22%3A%20%22medium%22%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7D%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7B%0A%09%09%09%09%09%22type%22%3A%20%22Input.ChoiceSet%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22style%22%3A%20%22compact%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22isMultiSelect%22%3A%20false%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22id%22%3A%20%22sCommodity%22%2C%0A%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%22choices%22%3A%20%5B%0A%09%09%09%09%09%20%20%7B%0A%09%09%09%09%09%09%22%24data%22%3A%20%22%7Bcommodities%7D%22%2C%0A%09%09%09%09%09%09%22title%22%3A%20%22%7BCommodityName%7D%22%2C%0A%09%09%09%09%09%09%22value%22%3A%20%22%7BCommodityCode%7D%22%0A%09%09%09%09%09%20%20%7D%0A%09%09%09%09%09%5D%0A%09%09%09%09%7D%0A%09%09%09%5D%2C%0A%09%09%09%22actions%22%3A%20%5B%0A%09%09%09%09%7B%0A%09%09%09%09%09%22type%22%3A%20%22Action.Submit%22%2C%0A%09%09%09%09%09%22title%22%3A%20%22Create%22%0A%09%09%09%09%7D%0A%09%09%09%5D%0A%09%09%7D%0A%09%7D%2C%0A%20%20%20%20%22sap.platform.mobilecards%22%3A%20%7B%20%20%22compatible%22%3A%20false%20%7D%0A%7D")),
        CardMetaError : "",
        cardBasePath : "/home/user/projects/NexGenUICards/NexGen-Cards/Production/CreateContractWorkspace/",
        cardBaseRelativePath : "Production/CreateContractWorkspace",
        cardUseMeta: true,
        cardWPBaseURL : "",//getWPBaseURL(),
        cardDestinationBaseURL: "",//getWPBaseURL(true),
        ui5Version: "1.87.0",
        ui5Url: "https://sapui5.hana.ondemand.com/1.87.0/resources/sap-ui-core.js"
    };

    function getWPBaseURL(bDestination) {
        var path = window.location.href;
        path = bDestination?path.substring(0, path.indexOf("mini-browser")):path.substring(0, path.indexOf("mini-browser")+12);
        return path;
    }
    function addSheetFile(path){
        var fileref=parent.document.createElement("link");
        fileref.id="cardpreviewwrapper";
        fileref.rel="stylesheet";
        fileref.type="text/css";
        fileref.href=getWPBaseURL() + '/' + path;
        fileref.media="screen";
        var headobj=parent.document.getElementsByTagName('head')[0];
        headobj.appendChild(fileref);
    }
    function delSheetFile(){
        var headobj=parent.document.getElementsByTagName('head')[0];
        var linkobj = parent.document.getElementById("cardpreviewwrapper");
        if (headobj && linkobj) {
            headobj.removeChild(linkobj);
        }
    }
window.parent.addEventListener('message', event => {
    if (typeof(event.data) == "string" || !event.data.data) return;
    const message = event.data.data;
    switch (message.cmd) {
        case 'refreshPreview':
            document.updateCard(message.data);
            break;
        default: break;
    }
});
    document.loadCard = function()
    {
        _oCardInfo.cardWPBaseURL = getWPBaseURL();
        _oCardInfo.cardDestinationBaseURL = getWPBaseURL(true);

        addSheetFile(_oCardInfo.cardWrapperCSSPath);
        var contentDoc=document.getElementById("previewframe").contentDocument;
        var ui5Url = _oCardInfo.ui5Url; //"https://sapui5.hana.ondemand.com/" + _oCardInfo.ui5Version + "/resources/sap-ui-core.js";
        contentDoc.loadCard(ui5Url, _oCardInfo);
        //contentDoc.previewCard(_oCardInfo);
    };

    document.updateCard = function(data)
    {
        var meta = "{}", metaError = "";
        try {
            meta = JSON.parse(data.meta);
        }catch(err) {
            meta = "{}";
            metaError = err.message;
        }
        _oCardInfo.cardMetaPath = data.path;
        _oCardInfo.cardMeta = meta;
        _oCardInfo.CardMetaError = metaError;
        _oCardInfo.cardBasePath = data.cardBasePath;
        _oCardInfo.cardBaseRelativePath = data.cardBaseRelativePath;
        _oCardInfo.cardUseMeta = true;
        _oCardInfo.cardWPBaseURL = getWPBaseURL();
        _oCardInfo.cardDestinationBaseURL = getWPBaseURL(true);
        if (data.ui5Version !== _oCardInfo.ui5Version) {
            var iframe=document.getElementById("previewframe");
            _oCardInfo.ui5Version = data.ui5Version;
            iframe.src = getWPBaseURL() + '/' + "/tmp/vscode-unpacked/uicard-dk-1.3.20210319.vsix/extension/resources/previewcard.html" + "?time="+new Date().getTime();
            //iframe.src = getWPBaseURL() + '/' + "/tmp/vscode-unpacked/uicard-dk-1.3.20210319.vsix/extension/resources/previewcard.html" + "?ui5Version="+_oCardInfo.ui5Version+"&time="+new Date().getTime();
            return;
        }
        var contentDoc=document.getElementById("previewframe").contentDocument;
        contentDoc.updateCard(_oCardInfo);
    };
    </script>
</head>

<body style="margin:0;"  onunload="unload()" >
    <iframe id="previewframe" width="100%" style="display:block;border: none;"></iframe>
    <script type="text/javascript">
    var iframe=document.getElementById("previewframe");
    iframe.src = getWPBaseURL() + '/' + "/tmp/vscode-unpacked/uicard-dk-1.3.20210319.vsix/extension/resources/previewcard.html" + "?time="+new Date().getTime();
    //iframe.src = getWPBaseURL() + '/' + "/tmp/vscode-unpacked/uicard-dk-1.3.20210319.vsix/extension/resources/previewcard.html" + "?ui5Version="+_oCardInfo.ui5Version;
    //iframe.src = pre + "/tmp/vscode-unpacked/uicard-dk-1.3.20210319.vsix/extension/resources/previewcard.html?cardBasePath=\"/home/user/projects/NexGenUICards/NexGen-Cards/Production/CreateContractWorkspace/\"";
    if (iframe.attachEvent){
        iframe.attachEvent("onload", function(){
            //var height=($.browser.msie||$.browser.opera)? iframe.document.body.scrollHeight:iframe.contentDocument.body.offsetHeight;
            //var height=($.browser.msie||$.browser.opera)? document.body.scrollHeight:document.body.offsetHeight;
            iframe.height = window.innerHeight;
            document.loadCard();
        });
        iframe.attachEvent("onunload", function(){
            delSheetFile();
        });
    } else {
        iframe.onload = function(){
            //var height=($.browser.msie||$.browser.opera)? iframe.document.body.scrollHeight:iframe.contentDocument.body.offsetHeight;
            //var height=($.browser.msie||$.browser.opera)? document.body.scrollHeight:document.body.offsetHeight;
            iframe.height = window.innerHeight;
            document.loadCard();
        };
        iframe.onunload = function(){
            delSheetFile();
        };
    }
    window.onunload = function(){
        //alert("window.onunload");
        //delSheetFile();
    };

    </script>
</body>
</html>