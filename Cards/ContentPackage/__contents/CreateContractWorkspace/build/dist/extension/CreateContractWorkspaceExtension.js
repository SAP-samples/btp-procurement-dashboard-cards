sap.ui.define(["sap/ui/integration/Extension","sap/m/MessageBox"],function(e,t){"use strict";var r=e.extend("sap.ariba.CreateContractWorkspace");r.prototype.init=function(){e.prototype.init.apply(this,arguments);this.attachAction(this._handleAction.bind(this))};r.prototype.getData=function(){var e=this.getCard();var t=e.getCombinedParameters().suppliers;var r=e.getCombinedParameters().commodities;return new Promise(function(e,a){var n={suppliers:JSON.parse(t),commodities:JSON.parse(r)};e(n)})};r.prototype._handleAction=function(e){var r=this.getCard(),a=e.getParameter("type"),n=e.getParameter("parameters"),o=n.data;if(a!=="Submit"){return}var i=e.getSource().getParent().getBindingContext().getModel(),s=i.getProperty("/suppliers").find(function(e){return e.SupplierId===o.sSupplierId});if(!s){return}o.sSMVendorId=s.SMVendorId;o.sUser=r.getCombinedParameters().username;o.sRealm=r.getCombinedParameters().realm;o.sCurrency=r.getCombinedParameters().currency;o.sTemplateId=r.getCombinedParameters().templateId;e.preventDefault();r.request({url:"{{destinations.wzcd}}/doCreateContractWorkspace",dataType:"json",method:"POST",withCredentials:true,parameters:o,headers:{"Content-Type":"application/json"}}).then(function(e){r.showMessage("You did it! A new contract has been created!","Success");t.success("You did it! A new contract has been created!",{actions:["Goto Contract",t.Action.CLOSE],emphasizedAction:"Goto Contract",onClose:function(t){if(t==="Goto Contract"){sap.m.URLHelper.redirect("http://"+r.getCombinedParameters().datacenter+".ariba.com/Sourcing/Main/ad/viewDocument?realm="+r.getCombinedParameters().realm+"&ID="+e.value,true)}}})}).catch(function(e){r.showMessage(e,"Error")})};return r});